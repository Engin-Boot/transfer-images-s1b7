name: Building scu

on:

  push:

    branches: [ master ]

  pull_request:

    branches: [ master ]

jobs:
  build-scu:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
      
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v1.0.2 
      with:
          vs-version: 15.0
    
    #- name: subscribe1 build
     # run: msbuild scu.vcxproj /p:configuration=debug /p:platform=x64
 
    - name: msbuild Project build
      run:  msbuild .\SenderTest1\TransferMedicalimages.vcxproj /p:configuration=debug /p:platform=x64
  
      
    - name: create gcno
      run: g++ --coverage SenderTest1\*.cpp 
    
    #- name: move gcno to sender test dir
     # run: move *.gcno SenderTest 

    - name: copy senderTestApp to mc3lib
      run:  copy .\SenderTest1\x64\debug\TransferMedicalimages.exe .\mc3lib
    
    - name: run sender Test
      run: .\mc3lib\senderTestApp.exe 

    - name: move .gcda files to sender test dir
      run:  move *.gcda SenderTest

    - name: sender coverage report
      run:  gcov -r SenderTest\*.cpp
